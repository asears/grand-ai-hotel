<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fireworks Debug Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
        }
        #debug {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border: 2px solid #0f0;
            max-width: 500px;
            font-size: 12px;
            z-index: 1000;
        }
        #canvas {
            border: 1px solid #0f0;
            display: block;
            margin: 20px auto;
        }
        .good { color: #0f0; }
        .bad { color: #f00; }
        .warn { color: #ff0; }
    </style>
</head>
<body>
    <div id="debug">
        <h3>üîç Fireworks Debug Console</h3>
        <div id="log"></div>
    </div>
    <canvas id="canvas" width="800" height="600"></canvas>

    <script type="module">
        const log = document.getElementById('log');
        
        function addLog(msg, type = 'good') {
            const line = document.createElement('div');
            line.className = type;
            line.textContent = `${new Date().toLocaleTimeString()}: ${msg}`;
            log.appendChild(line);
            if (log.children.length > 20) {
                log.removeChild(log.firstChild);
            }
        }

        // Simple particle system test
        class SimpleParticles {
            constructor(count) {
                this.particles = [];
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x: 0, y: 0, vx: 0, vy: 0,
                        r: 0, g: 0, b: 0, a: 0,
                        life: 0, maxLife: 1, size: 2
                    });
                }
                addLog(`Created ${count} particles`, 'good');
            }

            spawn(x, y, count) {
                let spawned = 0;
                for (let p of this.particles) {
                    if (p.life <= 0 && spawned < count) {
                        const angle = (Math.PI * 2 * spawned) / count;
                        const speed = 100 + Math.random() * 100;
                        
                        p.x = x;
                        p.y = y;
                        p.vx = Math.cos(angle) * speed;
                        p.vy = Math.sin(angle) * speed - 150;
                        p.r = 0;
                        p.g = 2.0; // Bright green
                        p.b = 0.25;
                        p.a = 1;
                        p.life = 2;
                        p.maxLife = 2;
                        p.size = 3;
                        spawned++;
                    }
                }
                addLog(`Spawned ${spawned} particles at (${x}, ${y})`, spawned > 0 ? 'good' : 'bad');
                return spawned;
            }

            update(dt) {
                let alive = 0;
                for (let p of this.particles) {
                    if (p.life > 0) {
                        p.vy += 50 * dt; // Gravity
                        p.x += p.vx * dt;
                        p.y += p.vy * dt;
                        p.vx *= 0.99;
                        p.vy *= 0.99;
                        p.life -= dt;
                        p.a = Math.max(0, p.life / p.maxLife);
                        alive++;
                    }
                }
                return alive;
            }

            getAlive() {
                return this.particles.filter(p => p.life > 0);
            }
        }

        // Canvas 2D rendering test
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        addLog('Canvas initialized', 'good');

        const particles = new SimpleParticles(1000);
        let frameCount = 0;
        let lastSpawn = 0;

        function render() {
            // Clear
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Update
            const dt = 1/60;
            const alive = particles.update(dt);

            // Auto-spawn fireworks every 2 seconds
            if (frameCount - lastSpawn > 120) {
                const x = 200 + Math.random() * 400;
                const y = 300;
                particles.spawn(x, y, 50);
                lastSpawn = frameCount;
            }

            // Draw particles
            const aliveParticles = particles.getAlive();
            ctx.fillStyle = '#00ff00';
            for (let p of aliveParticles) {
                ctx.globalAlpha = p.a;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.globalAlpha = 1;

            // Status
            if (frameCount % 60 === 0) {
                addLog(`Frame ${frameCount}: ${alive} alive particles`, alive > 0 ? 'good' : 'warn');
            }

            frameCount++;
            requestAnimationFrame(render);
        }

        // Click to spawn
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);
            particles.spawn(x, y, 100);
        });

        addLog('Starting render loop...', 'good');
        render();
    </script>
</body>
</html>
